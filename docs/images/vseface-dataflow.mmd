sequenceDiagram
    participant User as ìŠ¤íŠ¸ë¦¬ë¨¸
    participant WebCam as ì›¹ìº 
    participant VSeeFace as VSeeFace<br/>(VMC Protocol)
    participant VMC as packages/vtuber<br/>VMC Client
    participant SS as packages/stream-server<br/>Express + WS
    participant GH as GitHub Webhook
    participant CB as youtuber_chatbot
    participant OBS as OBS Overlay<br/>Browser Source

    %% Phase 1: VSeeFace ê¸°ë³¸ ì—°ë™
    Note over User,VSeeFace: Phase 1: VSeeFace ì—°ê²° ë° ì–¼êµ´ ì¶”ì 
    User->>WebCam: ì–¼êµ´ ì›€ì§ì„ (ê³ ê°œ ë„ë•ì„, í‘œì •)
    WebCam->>VSeeFace: ì–¼êµ´ ì¶”ì  ë°ì´í„° (30fps)
    VSeeFace->>VSeeFace: BlendShape ê³„ì‚°<br/>(Joy, Angry, Sorrow...)
    VSeeFace->>VMC: VMC UDP ì „ì†¡<br/>Port 39539<br/>/VMC/Ext/Blend/Val
    VMC->>SS: WebSocket ì—°ê²°<br/>vtuber ì±„ë„ êµ¬ë…
    VMC->>SS: í‘œì • ë°ì´í„° ì „ì†¡<br/>type: 'vtuber:tracking'
    SS->>OBS: WebSocket ë¸Œë¡œë“œìºìŠ¤íŠ¸<br/>ì•„ë°”íƒ€ ìƒíƒœ ì—…ë°ì´íŠ¸

    %% Phase 3: GitHub ì´ë²¤íŠ¸ ë°˜ì‘
    Note over GH,OBS: Phase 3: GitHub ì´ë²¤íŠ¸ â†’ ì•„ë°”íƒ€ ë°˜ì‘
    GH->>SS: POST /webhook/github<br/>Event: push (Commit)
    SS->>SS: handlePush() ì‹¤í–‰<br/>CommitPayload ìƒì„±
    SS->>VMC: í‘œì • íŠ¸ë¦¬ê±°<br/>type: 'vtuber:expression'<br/>payload: {expression: 'happy', duration: 2000}
    VMC->>VSeeFace: VMC UDP ì „ì†¡<br/>/VMC/Ext/Blend/Apply<br/>Joy=1.0
    VSeeFace->>VSeeFace: ì•„ë°”íƒ€ í‘œì • ì—…ë°ì´íŠ¸<br/>(2ì´ˆê°„ happy)
    SS->>OBS: WebSocket ë¸Œë¡œë“œìºìŠ¤íŠ¸<br/>ë°˜ì‘ ì•„ì´ì½˜ í‘œì‹œ (ğŸ‰)
    OBS->>OBS: ì˜¤ë²„ë ˆì´ ë Œë”ë§<br/>ì•„ì´ì½˜ 2ì´ˆê°„ í‘œì‹œ

    %% Phase 4: ì±„íŒ… ìƒí˜¸ì‘ìš©
    Note over CB,OBS: Phase 4: ì±„íŒ… ê°ì • ë¶„ì„ â†’ ì•„ë°”íƒ€ ë°˜ì‘
    CB->>SS: POST /api/chat/emotion<br/>{message: "ëŒ€ë°•!", emotion: "positive"}
    SS->>SS: mapChatEmotion()<br/>"positive" â†’ "happy"
    SS->>VMC: í‘œì • íŠ¸ë¦¬ê±°<br/>payload: {expression: 'happy', duration: 2000, trigger: 'chat'}
    VMC->>VSeeFace: VMC UDP ì „ì†¡<br/>/VMC/Ext/Blend/Apply<br/>Joy=1.0
    VSeeFace->>VSeeFace: ì•„ë°”íƒ€ í‘œì • ì—…ë°ì´íŠ¸
    SS->>OBS: WebSocket ë¸Œë¡œë“œìºìŠ¤íŠ¸<br/>ì±„íŒ… ë°˜ì‘ í‘œì‹œ (ğŸ’¬)

    %% Phase 2: OBS ì˜¤ë²„ë ˆì´
    Note over User,OBS: Phase 2: OBS ì˜¤ë²„ë ˆì´ í†µí•©
    User->>OBS: OBS ì‹¤í–‰<br/>Browser Source ì¶”ê°€
    OBS->>SS: HTTP GET<br/>http://localhost:3001/overlay
    SS->>OBS: HTML ì‘ë‹µ<br/>(Vite ë²ˆë“¤)
    OBS->>OBS: Window Capture ì¶”ê°€<br/>VSeeFace (320x180)
    OBS->>OBS: ë ˆì´ì•„ì›ƒ êµ¬ì„±<br/>1920x1080

    %% íƒ€ì´ë° ë‹¤ì´ì–´ê·¸ë¨
    Note over GH,OBS: íƒ€ì´ë°: GitHub Commit â†’ ì•„ë°”íƒ€ ë°˜ì‘
    Note right of GH: T=0ms: Commit push
    Note right of SS: T=100ms: Webhook ìˆ˜ì‹ 
    Note right of VMC: T=200ms: VMC ì „ì†¡
    Note right of VSeeFace: T=300ms: ì•„ë°”íƒ€ ì—…ë°ì´íŠ¸
    Note right of OBS: T=500ms: ì˜¤ë²„ë ˆì´ í‘œì‹œ
    Note over GH,OBS: ì´ ì§€ì—°ì‹œê°„: < 1ì´ˆ âœ…
